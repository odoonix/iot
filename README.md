# پروتکل ارتباط در شبکه اشیا برای مدیریت ورود و خرج

برای مدیریت ورود و خروج علاوه بر ساعت ورود و خروج کارهای دیگری مانند مدیریت افراد باید انجام شود. در این سند نحوه ارتباط اجزا برای انجام این کارها به صورت دقیق تعیین شده.

پروتکل بر اساس ساختارهای شبکه اینترنت اشیا طراحی شده. پروتکل پایه MQTT است.

TODO: تعیین دقیق نسه پروتکل

## چه کسی بخواند؟

در این سند پروتکل به صورت فنی بیان شده و برای توسعه دهندگان مناسب است.

## ویرایش‌ها

TODO: جدول تغییرات اضافه شود.



# معرفی تاپیک‌ها

سه تاپیک برای این پروتکل در نظر گرفته شده که عبارتند از:

* /attendences
* /employes
* /maintenances

## attendence

این تاپیک برای ثبت حضور و غیاب ها است.
داده های حضور و غیاب از دستگاه‌ها را در اودوو ثبت میکند.

ساختار داده ای که از دستگاه‌ها به تاپیک attedence وارد میشود باید ساختار داده‌ای زیر را داشته باشد.

نکته: این ساختار داده‌ای به فرمت JSON و با استاندارد UTF8  کدگذاری و در بدنه پیام ارسال می‌شود.

```json
thing_id = int (zk id)
attendence[{  
  employee_id = int  
  timestamp = datetime  
  punch = int [1,4] 1:in 4:out  
}, ]  
```

<p align ='right'>
داده هایی که از تاپیک attendence  در odoo ثبت میشود. این داده ها صرفا در یک جدول به جز جدول hr_attendence در odoo ثبت میشود.  این داده ها پس از چک شدن در جدول اصلی ذخیره میشوند  <br />


تاپیک employee: این تاپیک برای ثبت نام کاربران است.  <br />
ساختار داده هایی که از دستگاه zk وارد تاپیک employee و از تاپیک employee وارد odoo میشود. <br />
</p>


<pre>
things_id = int 
employee{[ 
  employee_id = int 
  employee_name = str 
  password = (number or finger print) 
]} 
</pre>



<p align ='right'>
ساختار داده هایی که از odoo وارد تاپیک employee و از تاپیک employee وارد zk میشود. <br /> مشابه ساختار بالا است <br /> 

تاپیک maintenance: اگر دستگاه جدیدی وارد سیستم شود یا دستگاهی خراب شود از این تاپیک استفاده میشود <br />
مثلا اگر دستگاه جدیدی وصل شود<br /> 
  
</p>

<pre>
things_id = int 
devices [{
  problem = 'syc'
}]
</pre>

<p align ='right'>
اگر این اتفاق بیفته . odoo باید لیست کاربران را در تاپیک employee قرار بده و دستگاه zk جدید لیست کاربران را بخواند.
</p>
